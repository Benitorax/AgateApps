machine:
    php:
        version: 5.6.22
    node:
        version: v6.1.0
    environment:
        CODECOV_TOKEN: 5b127f85-7030-411d-8f65-8f371c6eac0b
        SYMFONY_ENV: test
        SYMFONY_DEBUG: 1
        PATH: "${PATH}:${HOME}/${CIRCLE_PROJECT_REPONAME}/node_modules/.bin"
        PHPUNIT_PARAMETERS: ' --log-junit $CIRCLE_TEST_REPORTS/phpunit/junit.xml --coverage-clover $CIRCLE_TEST_REPORT/phpunit/clover.xml '

dependencies:
    override:
        - '[[ -d "vendor" ]] || mkdir vendor'
        - '[[ -d "~/.composer/cache" ]] || mkdir -p ~/.composer/cache'
        - 'mkdir -p $CIRCLE_TEST_REPORTS/phpunit'
        - 'echo "date.timezone = Europe/Paris" >> /opt/circleci/php/$(phpenv global)/etc/php.ini'
    cache_directories:
        - '~/.composer'
        - '~/.cache/yarn'
        - 'vendor'

test:
    override:
        - 'composer install --classmap-authoritative --no-interaction --no-scripts'
        - './tests/ci/ci.bash'
    post:
        - 'bash <(curl -s https://codecov.io/bash) -f $CIRCLE_TEST_REPORT/phpunit/clover.xml'
