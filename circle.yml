machine:
    php:
        version: 5.6.22
    node:
        version: v6.1.0
    environment:
        SYMFONY_ENV: test
        SYMFONY_DEBUG: 1
        PATH: "${PATH}:${HOME}/${CIRCLE_PROJECT_REPONAME}/node_modules/.bin"

dependencies:
    cache_directories:
        - ~/.cache/yarn
    override:
        - 'echo "date.timezone = Europe/Paris" > /opt/circleci/php/$(phpenv global)/etc/conf.d/date.ini'
        - yarn
        - composer install --no-interaction

test:
    override:
        - './node_modules/.bin/gulp dump'
        - './tests/ci/ci.bash || if [[ $? == 1 ]]; then echo "Exit code is 1..."; exit 0; else exit $? ; fi'
