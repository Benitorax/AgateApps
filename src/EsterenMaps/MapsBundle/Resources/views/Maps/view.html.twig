{% extends "::base.html.twig" %}

{% block title %}{{ 'Carte' | trans }} {{ map.name | trans }} - {{ parent() }}{% endblock %}

{% block footer '' %}

{% block layout %}
    {% block menus %}{{ parent() }}{% endblock %}
    <div id="map_wrapper">
        <div id="esterenmap_sidebar"></div>
        <div id="map"></div>
        <div id="inputs_container"></div>
    </div>
{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('css/maps_lib.css') }}" type="text/css" />
    <link rel="stylesheet" href="{{ asset('css/fontawesome.css') }}" type="text/css" />
    <style type="text/css" id="map_add_style"></style>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript" src="{{ asset('js/maps_lib.js') }}"></script>

    <script type="text/javascript">
        (function(w, d){
            try {
                d.map = new EsterenMap({
                    id: {{ map.id }},
                    imgUrl: "",
                    apiUrls: {
                        base: "http://{{ esteren_domains_api }}/{{ app.request.locale }}",
                        settings: "{{ url('esterenmaps_api_maps_settings_distant', {"id":map.id}) }}",
                        tiles: "http://{{ esteren_domains_api }}{{ asset('maps_tiles/'~map.id~'/{z}/{y}/{x}.jpg') }}"
                    },
                    LeafletMapBaseOptions: {
                        zoom: {{ map.startZoom }},
                        maxZoom: {{ map.maxZoom }}
                        {% if map.jsonBounds|length %},
                        maxBounds: {{ map.bounds|raw }}
                        {% endif %}
                    },
                    LeafletLayerBaseOptions: {
                        maxZoom: {{ map.maxZoom }},
                        maxNativeZoom: {{ map.maxZoom }},
                        tileSize: {{ tile_size }},
                        noWrap: false
                        {# Have to wait until bounds are supported in CANVAS mode #}
                        {#% if map.jsonBounds|length %},
                        bounds: {{ map.bounds|raw }}
                        {% endif %#}
                    }
                });
            } catch (e) {
                console.error(e);
            }
        })(window, document);
    </script>
{% endblock %}
