{% extends "::layout.html.twig" %}


{% block stylesheets %}
{{ parent() }}
<style type="text/css" id="map_add_style"></style>
{% endblock %}

{% block title %}{{ 'Modifier une carte' | trans({},'pages.titles') }} {{ map.name | trans }} - {{ parent() }}{% endblock %}

{% trans_default_domain 'admin.maps.edit' %}

{% block content_for_layout %}

<form id="map_edit_form" action="{{ url('esterenmaps_maps_maps_edit', {'id':map.id}) }}" method="post" class="form-horizontal">
    <fieldset>
        <div>
            {% include 'EsterenMapsBundle:Maps:edit_menu.html.twig' %}
        </div>
        <div id="map"></div>
        {#<div class="row">#}
            {#<div class="col-sm-3">#}
                {#{% include 'EsterenMapsBundle:Maps:edit_menu.html.twig' %}#}
            {#</div>#}
            {#<div class="col-sm-9">#}
                {#&#123;&#35;% include 'EsterenMapsBundle:Maps:edit_mapWrapper.html.twig' %&#35;&#125;#}
                {#<div id="map"></div>#}
            {#</div>#}
        {#</div>#}
        <div id="inputs_container"></div>
    </fieldset>
</form>
{% endblock %}

{% block javascripts %}
    {{ parent() }}

    {#% javascripts
        '@EsterenMapsBundle/Resources/public/js/jquery.mousewheel.min.js'
        '@EsterenMapsBundle/Resources/public/js/jquery.transform2d.js'
        '@EsterenMapsBundle/Resources/public/js/map.js'
        output="js/maps.js"
        filter="?yui_js"
    %}<script type="text/javascript" src="{{ app.request.getSchemeAndHttpHost() ~ asset_url }}"></script>
{% endjavascripts %#}

    {% javascripts
        '@EsterenMapsBundle/Resources/public/js/leaflet-src.js'
        '@EsterenMapsBundle/Resources/public/js/leaflet.draw-src.js'
        '@EsterenMapsBundle/Resources/public/js/map_main.js'
        output="js/maps.js"
        filter=""
    %}<script type="text/javascript" src="{{ app.request.getSchemeAndHttpHost() ~ asset_url }}"></script>{% endjavascripts %}
{#filter="?yui_js"#}
    {#{% javascripts
        '@EsterenMapsBundle/Resources/public/js/map_edit/*'
        output="js/maps_edit.js"
        filter="?yui_js"
    %}<script type="text/javascript" src="{{ app.request.getSchemeAndHttpHost() ~ asset_url }}"></script>
{% endjavascripts %}#}

    <script type="text/javascript">
        (function(){
            try {
            document.map = new EsterenMap({
                id: {{ map.id }},
                editMode: true,
                imgUrl: "{{ asset('bundles/esterenmaps/img') }}",
                apiUrls: {
                    base: "{{ url('corahnrin_api_api_get', {'serviceName':'maps','id':map.id}) }}",
                    tiles: "{{ tilesUrl }}"
                },
                idsZones: [{{ idsZones | join(',') }}],
                idsRoutes: [{{ idsRoutes | join(',') }}],
                idsMarkers: [{{ idsMarkers | join(',') }}],
                maxZoneId: {{ maxZones }},
                maxRouteId: {{ maxRoutes }},
                maxMarkerId: {{ maxMarkers }},
                LeafletPopupBaseContent : '{{ include('EsterenMapsBundle:Maps:popupContentMarker.html.twig',{"marker":emptyMarker,"markersTypes":markersTypes}) }}',
                LeafletMapBaseOptions: {
                    maxZoom: {{ map.maxZoom }},
                    maxBounds: [[-80.9,-180],[85.05,259.19]]
                },
                LeafletLayerBaseOptions: {
                    maxZoom: {{ map.maxZoom }},
                    maxNativeZoom: {{ map.maxZoom }},
                    tileSize: {{ tile_size }},
                    noWrap: false,
                    continuousWorld: true
                },
                LeafletMarkerBaseOptions: {
                    draggable: true
                },
                LeafletRouteBaseOptions: {
                }
            });
            } catch (e) {
                console.error(e);
            }
        })();
    </script>

{% endblock %}