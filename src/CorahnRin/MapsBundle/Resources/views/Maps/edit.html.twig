{% extends "::layout.html.twig" %}

{% block title %}{{ 'Modifier une carte' | trans }} {{ map.name | trans }} - {{ parent() }}{% endblock %}

{% block content_for_layout %}
{{ translationDomain('admin.maps.edit') }}
<form id="map_edit_form" action="{{ url('corahnrin_maps_maps_edit', {'id':map.id}) }}" method="post">
    <fieldset>
        <div class="row">
            <div class="col-sm-3">
                <div id="map_edit_menu" class="_row">
                    <ul class="list-inline">
                        <li data-toggle="tooltip" title="{{ 'Terminer l\'édition' | trans }}"><button class="btn btn-success" type="submit"><span class="glyphicon icon-ok_2"></span></button></li>
                        <li data-toggle="tooltip" title="{{ 'Désactiver le mouvement' | trans }}"><button class="btn btn-default" type="button" id="map_dont_move" data-map-container="map_container"><span class="glyphicon icon-move text-success"></span></button></li>

                    </ul>
                    <hr />
                    <label for="map_input_change">{{ 'Sélection' | trans }}</label>
                    <div class="input-group">
                        <span data-placement="right" data-toggle="tooltip" title="{{ 'Supprimer l\'élément sélectionné' | trans }}" class="input-group-btn">
                            <button class="btn btn-danger" disabled="disabled" type="button" id="map_delete_element" data-target-to-delete="">
                                <span class="glyphicon icon-bin"></span>
                            </button>
                        </span>
                        <input type="text" class="form-control" placeholder="{{ 'Nom de l\'élément sélectionné' | trans }}" disabled="disabled" value="" id="map_input_change" data-input-id="" />
                    </div>
                    <hr />
                    <button class="btn btn-block btn-default" type="button" id="map_add_zone" data-map-container="map_container" data-zones-container="map_zones">
                        <span class="glyphicon icon-vector_path_polygon"></span> {{ 'Ajouter une zone' | trans }}
                    </button>
                    <button class="btn btn-block btn-default" type="button" id="map_add_route" data-map-container="map_container" data-routes-container="map_routes">
                        <span class="glyphicon icon-vector_path_line"></span> {{ 'Ajouter une route' | trans }}
                    </button>
                </div>
            </div>
            <div class="col-sm-9">
                <div id="map_wrapper">
                    <div id="map_container" data-zoom="1" data-map-id="{{ map.id }}" data-init-url="{{ route_init }}">
                        <div id="map_labels"></div>
                        <svg id="map_zones" version="1.1" xmlns="http://www.w3.org/2000/svg">
                            {% for zone in map.zones %}
                                <polygon points="{{ zone.coordinates }}" id="map_add_zone_polygon[{{ zone.id }}]" />
                            {% endfor %}
                        </svg>
                        <div id="map_pins_polygons">
                            {% for zone in map.zones %}
                                {% for coords in zone.coordinates | split(' ') %}
                                    {% set coord = coords | split(',') %}
                                    <span class="glyphicon icon-screenshot map-icon-target" data-target-polygon="map_add_zone_polygon[{{ zone.id }}]" style="position: absolute;left: {{ coord.0 }}px;top: {{ coord.1 }}px;"></span>
                                {% endfor %}
                            {% endfor %}
                        </div>
                        <svg id="map_routes" version="1.1" xmlns="http://www.w3.org/2000/svg">
                            {% for route in map.routes %}
                                <polyline points="{{ route.coordinates }}" id="map_add_route_polyline[{{ route.id }}]" />
                            {% endfor %}
                        </svg>
                        <div id="map_pins_polylines">
                            {% for route in map.routes %}
                                {% for coords in route.coordinates | split(' ') %}
                                    {% set coord = coords | split(',') %}
                                    <span class="glyphicon icon-screenshot map-icon-target" data-target-polyline="map_add_route_polyline[{{ route.id }}]" style="position: absolute;left: {{ coord.0 }}px;top: {{ coord.1 }}px;"></span>
                                {% endfor %}
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </fieldset>
    {% for zone in map.zones %}
        <input type="hidden" value="{{ zone.name }}" name="map_add_zone_name[{{ zone.id }}]" id="input_map_add_zone_name[{{ zone.id }}]" />
        <input type="hidden" value="{{ zone.coordinates }}" name="map_add_zone_polygon[{{ zone.id }}]" id="input_map_add_zone_polygon[{{ zone.id }}]" />
    {% endfor %}
    {% for route in map.routes %}
        <input type="hidden" value="{{ route.name }}" name="map_add_route_name[{{ route.id }}]" id="input_map_add_route_name[{{ route.id }}]" />
        <input type="hidden" value="{{ route.coordinates }}" name="map_add_route_polyline[{{ route.id }}]" id="input_map_add_route_polyline[{{ route.id }}]" />
    {% endfor %}
</form>
{{ translationDomain() }}
{% endblock %}

{% block javascripts %}
    {{ parent() }}

    {% javascripts
        '@CorahnRinMapsBundle/Resources/public/js/jquery.mousewheel.min.js'
        '@CorahnRinMapsBundle/Resources/public/js/jquery.transform2d.js'
        '@CorahnRinMapsBundle/Resources/public/js/map.js'
        output="js/maps.js"
        filter="?yui_js"
    %}<script type="text/javascript" src="{{ app.request.getSchemeAndHttpHost() ~ asset_url }}"></script>
{% endjavascripts %}

    {% javascripts
        '@CorahnRinMapsBundle/Resources/public/js/map_edit/*.js'
        output="js/maps_edit.js"
        filter="?yui_js"
    %}<script type="text/javascript" src="{{ app.request.getSchemeAndHttpHost() ~ asset_url }}"></script>
{% endjavascripts %}

    <script type="text/javascript">
        document.corahn_rin_map = new Map({
            allowZoom: false,
            zoom: {{ map.maxZoom }}
        });
        document.addZonePolygonId = {{ max }};
    </script>
{% endblock %}