(function(b){function a(C){var y=this;var v=null;if(isNaN(v)){console.error("Cannot generate map : wrong id")}var c={current:1,max:0};var F="";var w="";var l="";var A=null;var m={};var e={zoom:null,showImages:null};var z={width:0,height:0};var r;var j=null;var s=null;var t=true;var D=true;if(typeof C!=="object"){C={}}if(typeof C.allowMove!=="undefined"){d(C.allowMove)}if(typeof C.allowZoom!=="undefined"){p(C.allowZoom)}if(typeof C.zoom!=="undefined"){c.current=C.zoom;console.info("specific zoom : "+C.zoom)}v=C.id?C.id:document.getElementById("map_container").getAttribute("data-map-id");A=C.initUrl?C.initUrl:document.getElementById("map_container").getAttribute("data-init-url");b.ajax({url:A,dataType:"json",type:"post",data:{id:v},success:function(G){if(G.id){F=G.name;w=G.name;m=G.identifications;c.max=G.maxZoom;r=G.imgSize;l=G.tilesUrl;q(c.current)}}});if(document.getElementById("map_wrapper")){j=document.getElementById("map_wrapper")}if(document.getElementById("map_container")){s=document.getElementById("map_container")}if(!j||!s){console.error("Cannot generate map : failed identification of wrapper and container");return}this.id=function(){return v};this.name=function(){return F};this.nameSlug=function(){return w};this.initUrl=function(){return A};this.container=function(){return s};this.wrapper=function(){return j};this.tilesUrl=function(){return l};this.imgSize=function(){return r};this.identifications=function(){return m};this.zoom=function(G){return f(G)};this.position=function(G){return o(G)};this.allowMove=function(G){return d(G)};this.allowZoom=function(G){return p(G)};this.generateTiles=function(H,G){return q(H,G)};this.identify=h;this.showImages=g;this.identify=h;this.zoomIn=B;this.zoomOut=u;b(window).resize(E);this.allowZoom(D);this.allowMove(t);function d(G){if(typeof G==="undefined"){return t}else{t=!!G;if(t){if(b(s).is(":ui-draggable")){b(s).draggable("enable")}else{b(s).draggable({addClasses:false,stop:g})}}else{if(!t&&b(s).is(":ui-draggable")){b(s).draggable("disable").removeClass("ui-state-disabled")}}}}function p(G){if(typeof G==="undefined"){return D}else{D=!!G;if(D){b(j).mousewheel(function(J,K,I,H){if(K>0){B()}else{if(K<0){u()}}return false})}else{if(!D){b(j).unbind("mousewheel")}}}}function f(G){if(G==="current"){return c.current}else{if(G==="max"){return c.max}else{return c}}}function o(G){if(G==="left"){return b(s).offset().left}else{if(G==="top"){return b(s).offset().top}else{return b(s).offset()}}}function k(G,H){if(isNaN(G)){console.error("Cannot zoom on map : wrong zoom level injected to zoom function");return}if(document.getElementById("zoomContainer"+G)){b("#zoomContainer"+G).animate({transform:"scale("+H+")"},{duration:200,queue:false})}}function q(N,I){c.current=(N?N:c.current);if(!N){console.error("Cannot generate tiles : zoom is undefined");return false}var J=h(N),K=J.xmax,G=J.ymax,O=parseInt(J.wmax),M=parseInt(J.hmax),L,H;if(!J){console.error('Cannot generate tiles : identification failed for zoom value "'+N+'"');return false}if(I===1||I===-1){x(N,I)}for(i=1;i<=c.max;i++){L=document.getElementById("zoomContainer"+i);if(L){if(i>N){L.classList.add("hide")}else{L.classList.remove("hide")}}k(i,N/i)}L=document.getElementById("zoomContainer"+N);if(L){L.classList.remove("hide")}else{L=document.createElement("div");L.id="zoomContainer"+N;L.setAttribute("data-zoom-level",N);L.classList.add("zoom-container");L.id="zoomContainer"+N;L.style.zIndex=N*100;for(var P=0;P<G;P++){for(var Q=0;Q<K;Q++){H=document.createElement("img");H.src="";H.setAttribute("data-image-src",l.replace("{zoom}",N).replace("{y}",P).replace("{x}",Q));H.classList.add("map-image");H.style.top=(P*r)+"px";H.style.left=(Q*r)+"px";H.id="tile_"+N+"_"+P+"_"+Q;L.appendChild(H)}}s.appendChild(L)}E();clearTimeout(e.showImages);e.showImages=setTimeout(g,1000)}function n(G,H){}function x(K,H){var J=h(K);var I=h(K-H);var G=b(s).position().left-((parseInt(J.wmax)-parseInt(I.wmax))/2);var L=b(s).position().top-((parseInt(J.hmax)-parseInt(I.hmax))/2);b(s).animate({left:G+"px",top:L+"px"},{duration:200,queue:false})}function g(){b('img.map-image[src=""]').filter(function(){var R=b(this).offset().left-b(j).offset().left,P=b(this).offset().top-b(j).offset().top,T=b(j).width(),J=b(j).height();var S=R>0&&R<T,Q=P>0&&P<J,M=R+r>0&&R+r<T,K=Q,N=S,L=P+r>0&&P+r<J,V=M,U=L,O=S&&Q,H=M&&K,G=N&&L,I=V&&U;return O||H||G||I}).attr("src",function(){return this.getAttribute("data-image-src")})}function h(G){return m[(G?G:c.current)]}function E(){var G=h(c.current);if(!G){return false}b(j).height(b(window).height()-b("#footer").outerHeight(true)-b("#navigation").outerHeight(true));b(s).width(G.wmax).height(G.hmax)}function B(){c.current++;if(c.current>c.max){c.current=c.max;return false}clearTimeout(e.zoom);e.zoom=setTimeout(function(){q(c.current,1)},200)}function u(){c.current--;if(c.current<1){c.current=1;return false}clearTimeout(e.zoom);e.zoom=setTimeout(function(){q(c.current,-1)},200)}}window.Map=a})(jQuery);