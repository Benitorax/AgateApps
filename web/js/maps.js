/*! Copyright (c) 2013 Brandon Aaron (http://brandon.aaron.sh)
 * Licensed under the MIT License (LICENSE.txt).
 *
 * Version: 3.1.6
 *
 * Requires: jQuery 1.2.2+
 */
(function(a){if(typeof define==="function"&&define.amd){define(["jquery"],a)}else{if(typeof exports==="object"){module.exports=a}else{a(jQuery)}}}(function(b){var c=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],h=("onwheel" in document||document.documentMode>=9)?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],f=Array.prototype.slice,g,a;if(b.event.fixHooks){for(var d=c.length;d;){b.event.fixHooks[c[--d]]=b.event.mouseHooks}}b.event.special.mousewheel={version:"3.1.6",setup:function(){if(this.addEventListener){for(var k=h.length;k;){this.addEventListener(h[--k],j,false)}}else{this.onmousewheel=j}},teardown:function(){if(this.removeEventListener){for(var k=h.length;k;){this.removeEventListener(h[--k],j,false)}}else{this.onmousewheel=null}}};b.fn.extend({mousewheel:function(i){return i?this.bind("mousewheel",i):this.trigger("mousewheel")},unmousewheel:function(i){return this.unbind("mousewheel",i)}});function j(o){var n=o||window.event,m=f.call(arguments,1),p=0,l=0,k=0,i=0;o=b.event.fix(n);o.type="mousewheel";if("detail" in n){k=n.detail*-1}if("wheelDelta" in n){k=n.wheelDelta}if("wheelDeltaY" in n){k=n.wheelDeltaY}if("wheelDeltaX" in n){l=n.wheelDeltaX*-1}if("axis" in n&&n.axis===n.HORIZONTAL_AXIS){l=k*-1;k=0}p=k===0?l:k;if("deltaY" in n){k=n.deltaY*-1;p=k}if("deltaX" in n){l=n.deltaX;if(k===0){p=l*-1}}if(k===0&&l===0){return}i=Math.max(Math.abs(k),Math.abs(l));if(!a||i<a){a=i}p=Math[p>=1?"floor":"ceil"](p/a);l=Math[l>=1?"floor":"ceil"](l/a);k=Math[k>=1?"floor":"ceil"](k/a);o.deltaX=l;o.deltaY=k;o.deltaFactor=a;m.unshift(o,p,l,k);if(g){clearTimeout(g)}g=setTimeout(e,200);return(b.event.dispatch||b.event.handle).apply(this,m)}function e(){a=null}}));
(function(j,m,s,o,k){var q=s.createElement("div"),g=q.style,c="Transform",z=["O"+c,"ms"+c,"Webkit"+c,"Moz"+c],w=z.length,a,h,D="Float32Array" in m,G,t,C=/Matrix([^)]*)/,n=/^\s*matrix\(\s*1\s*,\s*0\s*,\s*0\s*,\s*1\s*(?:,\s*0(?:px)?\s*){2}\)\s*$/,F="transform",H="transformOrigin",E="translate",e="rotate",p="scale",y="skew",b="matrix";while(w--){if(z[w] in g){j.support[F]=a=z[w];j.support[H]=a+"Origin";continue}}if(!a){j.support.matrixFilter=h=g.filter===""}j.cssNumber[F]=j.cssNumber[H]=true;if(a&&a!=F){j.cssProps[F]=a;j.cssProps[H]=a+"Origin";if(a=="Moz"+c){G={get:function(I,i){return(i?j.css(I,a).split("px").join(""):I.style[a])},set:function(i,I){i.style[a]=/matrix\([^)p]*\)/.test(I)?I.replace(/matrix((?:[^,]*,){4})([^,]*),([^)]*)/,b+"$1$2px,$3px"):I}}}else{if(/^1\.[0-5](?:\.|$)/.test(j.fn.jquery)){G={get:function(I,i){return(i?j.css(I,a.replace(/^ms/,"Ms")):I.style[a])}}}}}else{if(h){G={get:function(L,K,i){var J=(K&&L.currentStyle?L.currentStyle:L.style),I,M;if(J&&C.test(J.filter)){I=RegExp.$1.split(",");I=[I[0].split("=")[1],I[2].split("=")[1],I[1].split("=")[1],I[3].split("=")[1]]}else{I=[1,0,0,1]}if(!j.cssHooks[H]){I[4]=J?parseInt(J.left,10)||0:0;I[5]=J?parseInt(J.top,10)||0:0}else{M=j._data(L,"transformTranslate",k);I[4]=M?M[0]:0;I[5]=M?M[1]:0}return i?I:b+"("+I+")"},set:function(N,O,J){var I=N.style,K,i,M,L;if(!J){I.zoom=1}O=v(O);i=["Matrix(M11="+O[0],"M12="+O[2],"M21="+O[1],"M22="+O[3],"SizingMethod='auto expand'"].join();M=(K=N.currentStyle)&&K.filter||I.filter||"";I.filter=C.test(M)?M.replace(C,i):M+" progid:DXImageTransform.Microsoft."+i+")";if(!j.cssHooks[H]){if((L=j.transform.centerOrigin)){I[L=="margin"?"marginLeft":"left"]=-(N.offsetWidth/2)+(N.clientWidth/2)+"px";I[L=="margin"?"marginTop":"top"]=-(N.offsetHeight/2)+(N.clientHeight/2)+"px"}I.left=O[4]+"px";I.top=O[5]+"px"}else{j.cssHooks[H].set(N,O)}}}}}if(G){j.cssHooks[F]=G}t=G&&G.get||j.css;j.fx.step.transform=function(M){var L=M.elem,J=M.start,N=M.end,R=M.pos,K="",P=100000,O,I,Q,S;if(!J||typeof J==="string"){if(!J){J=t(L,a)}if(h){L.style.zoom=1}N=N.split("+=").join(J);return j.extend(M,d(J,N))}O=J.length;while(O--){I=J[O];Q=N[O];S=+false;switch(I[0]){case E:S="px";case p:S||(S=" ");K=I[0]+"("+o.round((I[1][0]+(Q[1][0]-I[1][0])*R)*P)/P+S+","+o.round((I[1][1]+(Q[1][1]-I[1][1])*R)*P)/P+S+")"+K;break;case y+"X":case y+"Y":case e:K=I[0]+"("+o.round((I[1]+(Q[1]-I[1])*R)*P)/P+"rad)"+K;break}}M.origin&&(K=M.origin+K);G&&G.set?G.set(L,K,+true):L.style[a]=K};function v(K){K=K.split(")");var L=j.trim,O=-1,N=K.length-1,Q,I,J,M=D?new Float32Array(6):[],R=D?new Float32Array(6):[],P=D?new Float32Array(6):[1,0,0,1,0,0];M[0]=M[3]=P[0]=P[3]=1;M[1]=M[2]=M[4]=M[5]=0;while(++O<N){Q=K[O].split("(");I=L(Q[0]);J=Q[1];R[0]=R[3]=1;R[1]=R[2]=R[4]=R[5]=0;switch(I){case E+"X":R[4]=parseInt(J,10);break;case E+"Y":R[5]=parseInt(J,10);break;case E:J=J.split(",");R[4]=parseInt(J[0],10);R[5]=parseInt(J[1]||0,10);break;case e:J=f(J);R[0]=o.cos(J);R[1]=o.sin(J);R[2]=-o.sin(J);R[3]=o.cos(J);break;case p+"X":R[0]=+J;break;case p+"Y":R[3]=J;break;case p:J=J.split(",");R[0]=J[0];R[3]=J.length>1?J[1]:J[0];break;case y+"X":R[2]=o.tan(f(J));break;case y+"Y":R[1]=o.tan(f(J));break;case b:J=J.split(",");R[0]=J[0];R[1]=J[1];R[2]=J[2];R[3]=J[3];R[4]=parseInt(J[4],10);R[5]=parseInt(J[5],10);break}P[0]=M[0]*R[0]+M[2]*R[1];P[1]=M[1]*R[0]+M[3]*R[1];P[2]=M[0]*R[2]+M[2]*R[3];P[3]=M[1]*R[2]+M[3]*R[3];P[4]=M[0]*R[4]+M[2]*R[5]+M[4];P[5]=M[1]*R[4]+M[3]*R[5]+M[5];M=[P[0],P[1],P[2],P[3],P[4],P[5]]}return P}function r(K){var L,J,I,i=K[0],O=K[1],N=K[2],M=K[3];if(i*M-O*N){L=o.sqrt(i*i+O*O);i/=L;O/=L;I=i*N+O*M;N-=i*I;M-=O*I;J=o.sqrt(N*N+M*M);N/=J;M/=J;I/=J;if(i*M<O*N){i=-i;O=-O;I=-I;L=-L}}else{L=J=I=0}return[[E,[+K[4],+K[5]]],[e,o.atan2(O,i)],[y+"X",o.atan(I)],[p,[L,J]]]}function d(P,J){var M={start:[],end:[]},K=-1,I,L,N,O;(P=="none"||B(P))&&(P="");(J=="none"||B(J))&&(J="");if(P&&J&&!J.indexOf("matrix")&&u(P).join()==u(J.split(")")[0]).join()){M.origin=P;P="";J=J.slice(J.indexOf(")")+1)}if(!P&&!J){return}if(!P||!J||x(P)==x(J)){P&&(P=P.split(")"))&&(I=P.length);J&&(J=J.split(")"))&&(I=J.length);while(++K<I-1){P[K]&&(L=P[K].split("("));J[K]&&(N=J[K].split("("));O=j.trim((L||N)[0]);A(M.start,l(O,L?L[1]:0));A(M.end,l(O,N?N[1]:0))}}else{M.start=r(v(P));M.end=r(v(J))}return M}function l(K,L){var I=+(!K.indexOf(p)),J,i=K.replace(/e[XY]/,"e");switch(K){case E+"Y":case p+"Y":L=[I,L?parseFloat(L):I];break;case E+"X":case E:case p+"X":J=1;case p:L=L?(L=L.split(","))&&[parseFloat(L[0]),parseFloat(L.length>1?L[1]:K==p?J||L[0]:I+"")]:[I,I];break;case y+"X":case y+"Y":case e:L=L?f(L):0;break;case b:return r(L?u(L):[1,0,0,1,0,0]);break}return[[i,L]]}function B(i){return n.test(i)}function x(i){return i.replace(/(?:\([^)]*\))|\s/g,"")}function A(I,i,J){while(J=i.shift()){I.push(J)}}function f(i){return ~i.indexOf("deg")?parseInt(i,10)*(o.PI*2/360):~i.indexOf("grad")?parseInt(i,10)*(o.PI/200):parseFloat(i)}function u(i){i=/([^,]*),([^,]*),([^,]*),([^,]*),([^,p]*)(?:px)?,([^)p]*)(?:px)?/.exec(i);return[i[1],i[2],i[3],i[4],i[5],i[6]]}j.transform={centerOrigin:"margin"}})(jQuery,window,document,Math);
(function(b){function a(C){var y=this;var v=null;if(isNaN(v)){console.error("Cannot generate map : wrong id")}var c={current:1,max:0};var F="";var w="";var l="";var A=null;var m={};var e={zoom:null,showImages:null};var z={width:0,height:0};var r;var j=null;var s=null;var t=true;var D=true;if(typeof C!=="object"){C={}}if(typeof C.allowMove!=="undefined"){d(C.allowMove)}if(typeof C.allowZoom!=="undefined"){p(C.allowZoom)}if(typeof C.zoom!=="undefined"){c.current=C.zoom;console.info("specific zoom : "+C.zoom)}v=C.id?C.id:document.getElementById("map_container").getAttribute("data-map-id");A=C.initUrl?C.initUrl:document.getElementById("map_container").getAttribute("data-init-url");b.ajax({url:A,dataType:"json",type:"post",data:{id:v},success:function(G){if(G.id){F=G.name;w=G.name;m=G.identifications;c.max=G.maxZoom;r=G.imgSize;l=G.tilesUrl;q(c.current)}}});if(document.getElementById("map_wrapper")){j=document.getElementById("map_wrapper")}if(document.getElementById("map_container")){s=document.getElementById("map_container")}if(!j||!s){console.error("Cannot generate map : failed identification of wrapper and container");return}this.id=function(){return v};this.name=function(){return F};this.nameSlug=function(){return w};this.initUrl=function(){return A};this.container=function(){return s};this.wrapper=function(){return j};this.tilesUrl=function(){return l};this.imgSize=function(){return r};this.identifications=function(){return m};this.zoom=function(G){return f(G)};this.position=function(G){return o(G)};this.allowMove=function(G){return d(G)};this.allowZoom=function(G){return p(G)};this.generateTiles=function(H,G){return q(H,G)};this.identify=h;this.showImages=g;this.identify=h;this.zoomIn=B;this.zoomOut=u;b(window).resize(E);this.allowZoom(D);this.allowMove(t);function d(G){if(typeof G==="undefined"){return t}else{t=!!G;if(t){if(b(s).is(":ui-draggable")){b(s).draggable("enable")}else{b(s).draggable({addClasses:false,stop:g})}}else{if(!t&&b(s).is(":ui-draggable")){b(s).draggable("disable").removeClass("ui-state-disabled")}}}}function p(G){if(typeof G==="undefined"){return D}else{D=!!G;if(D){b(j).mousewheel(function(J,K,I,H){if(K>0){B()}else{if(K<0){u()}}return false})}else{if(!D){b(j).unbind("mousewheel")}}}}function f(G){if(G==="current"){return c.current}else{if(G==="max"){return c.max}else{return c}}}function o(G){if(G==="left"){return b(s).offset().left}else{if(G==="top"){return b(s).offset().top}else{return b(s).offset()}}}function k(G,H){if(isNaN(G)){console.error("Cannot zoom on map : wrong zoom level injected to zoom function");return}if(document.getElementById("zoomContainer"+G)){b("#zoomContainer"+G).animate({transform:"scale("+H+")"},{duration:200,queue:false})}}function q(N,I){c.current=(N?N:c.current);if(!N){console.error("Cannot generate tiles : zoom is undefined");return false}var J=h(N),K=J.xmax,G=J.ymax,O=parseInt(J.wmax),M=parseInt(J.hmax),L,H;if(!J){console.error('Cannot generate tiles : identification failed for zoom value "'+N+'"');return false}if(I===1||I===-1){x(N,I)}for(i=1;i<=c.max;i++){L=document.getElementById("zoomContainer"+i);if(L){if(i>N){L.classList.add("hide")}else{L.classList.remove("hide")}}k(i,N/i)}L=document.getElementById("zoomContainer"+N);if(L){L.classList.remove("hide")}else{L=document.createElement("div");L.id="zoomContainer"+N;L.setAttribute("data-zoom-level",N);L.classList.add("zoom-container");L.id="zoomContainer"+N;L.style.zIndex=N*100;for(var P=0;P<G;P++){for(var Q=0;Q<K;Q++){H=document.createElement("img");H.src="";H.setAttribute("data-image-src",l.replace("{zoom}",N).replace("{y}",P).replace("{x}",Q));H.classList.add("map-image");H.style.top=(P*r)+"px";H.style.left=(Q*r)+"px";H.id="tile_"+N+"_"+P+"_"+Q;L.appendChild(H)}}s.appendChild(L)}E();clearTimeout(e.showImages);e.showImages=setTimeout(g,1000)}function n(G,H){}function x(K,H){var J=h(K);var I=h(K-H);var G=b(s).position().left-((parseInt(J.wmax)-parseInt(I.wmax))/2);var L=b(s).position().top-((parseInt(J.hmax)-parseInt(I.hmax))/2);b(s).animate({left:G+"px",top:L+"px"},{duration:200,queue:false})}function g(){b('img.map-image[src=""]').filter(function(){var R=b(this).offset().left-b(j).offset().left,P=b(this).offset().top-b(j).offset().top,T=b(j).width(),J=b(j).height();var S=R>0&&R<T,Q=P>0&&P<J,M=R+r>0&&R+r<T,K=Q,N=S,L=P+r>0&&P+r<J,V=M,U=L,O=S&&Q,H=M&&K,G=N&&L,I=V&&U;return O||H||G||I}).attr("src",function(){return this.getAttribute("data-image-src")})}function h(G){return m[(G?G:c.current)]}function E(){var G=h(c.current);if(!G){return false}b(j).height(b(window).height()-b("#footer").outerHeight(true)-b("#navigation").outerHeight(true));b(s).width(G.wmax).height(G.hmax)}function B(){c.current++;if(c.current>c.max){c.current=c.max;return false}clearTimeout(e.zoom);e.zoom=setTimeout(function(){q(c.current,1)},200)}function u(){c.current--;if(c.current<1){c.current=1;return false}clearTimeout(e.zoom);e.zoom=setTimeout(function(){q(c.current,-1)},200)}}window.Map=a})(jQuery);
(function(a){if(document.getElementById("map_dont_move")){document.getElementById("map_dont_move").onclick=function(){var b=this.getAttribute("data-active");if(b==="true"){b="false";document.corahn_rin_map.allowMove(true);this.parentNode.classList.remove("active");this.children[0].classList.remove("text-danger");this.children[0].classList.add("text-success")}else{b="true";document.corahn_rin_map.allowMove(false);this.parentNode.classList.add("active");this.children[0].classList.add("text-danger");this.children[0].classList.remove("text-success")}this.setAttribute("data-active",b);return false}}if(document.getElementById("map_add_zone")){document.getElementById("map_add_zone").onclick=function(){var h=this,n,g,d,m,e=document.getElementById(this.getAttribute("data-zones-container")?this.getAttribute("data-zones-container"):"map_zones"),f=document.getElementById(this.getAttribute("data-map-container")?this.getAttribute("data-map-container"):"map_container"),k=document.addZonePolygonId?document.addZonePolygonId:0,b=document.addZonePolygonIdFull?document.addZonePolygonIdFull:"",j=this.getAttribute("data-active");if(j==="true"){j="false";this.parentNode.classList.remove("active");if(document.addZoneCoordinates.length>3&&document.addZonePolygon){document.addZonePolygon.setAttribute("points",document.addZoneCoordinates.join(" "));var g=document.createElement("input");g.id=document.addZonePolygon.id;g.name=document.addZonePolygon.id;g.value=document.addZoneCoordinates.join(" ");f.appendChild(g);g=null}else{document.addZonePolygon.parentNode.removeChild(document.addZonePolygon)}document.addZoneCoordinates=[];document.addZonePolygon=null;document.addZoneMapContainerOffset=null;d=document.querySelectorAll("polygon:not([points])");m=d.length;for(g=0;g<m;g++){d[g].parentNode.removeChild(d[g])}}else{j="true";this.parentNode.classList.add("active");while(document.getElementById("map_add_zone_polygon_"+k)){k++}b="map_add_zone_polygon["+k+"]";n=document.createElementNS("http://www.w3.org/2000/svg","polygon");n.id=b;e.appendChild(n);document.addZoneCoordinates=[];document.addZonePolygon=n;document.addZoneMapContainerOffset=a(f).offset()}this.setAttribute("data-active",j);f.setAttribute("data-add-zone",j);a(e).height(a(f).height());e.onmousedown=j==="false"?null:function(c){if(f.getAttribute("data-add-zone")==="true"){f.base_coords=c.clientX+","+c.clientY}};f.onmousemove=j==="false"?null:function(i){if(f.getAttribute("data-add-zone")==="true"){if(f.getAttribute("data-add-zone")==="true"&&document.addZoneCoordinates.length){var c=typeof i.offsetX!=="undefined"?i.offsetX:i.clientX-document.addZoneMapContainerOffset.left+window.pageXOffset;var o=typeof i.offsetY!=="undefined"?i.offsetY:i.clientY-document.addZoneMapContainerOffset.top+window.pageYOffset;c=parseInt(c);o=parseInt(o);var l=document.addZoneCoordinates.concat([c+","+o]);document.addZonePolygon.setAttribute("points",l.join(" "))}}};e.onmouseup=j==="false"?null:function(l){if(f.getAttribute("data-add-zone")==="true"){var i=l.clientX+","+l.clientY;if(i===f.base_coords){var c=typeof l.offsetX!=="undefined"?l.offsetX:l.clientX-document.addZoneMapContainerOffset.left+window.pageXOffset;var o=typeof l.offsetY!=="undefined"?l.offsetY:l.clientY-document.addZoneMapContainerOffset.top+window.pageYOffset;c=parseInt(c);o=parseInt(o);if(isNaN(c)||isNaN(o)){console.error("Error with points "+(isNaN(c)?"x":"y")+"\n event : ",l);return false}document.addZoneCoordinates.push(c+","+o);document.addZonePolygon.setAttribute("points",document.addZoneCoordinates.join(" "))}}};return false}}})(jQuery);