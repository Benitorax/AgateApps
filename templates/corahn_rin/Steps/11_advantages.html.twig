{% extends 'corahn_rin/Steps/step_base.html.twig' %}

{% trans_default_domain 'corahn_rin' %}

{% macro avantage_display(avtg, indication_type_single_choice, indication_type_single_value) %}

    {% set prefix = avtg.isDesv() ? 'desv' : 'avtg' %}

    <div class="col m6">
        {% set class_more = '' %}
        {% if advantages[avtg.id] is defined and advantages[avtg.id] > 0 %}
            {% set class_more = ' btn-state-'~advantages[avtg.id] %}
        {% endif %}

        {% set tooltip_text %}
            {{ avtg.description | escape('html_attr') }}
            <br>
            ({{ 'advantages.xp_cost' | trans | escape('html_attr') }} : {{ avtg.xp }})
        {% endset %}

        <label
                id="label-avdesv-{{ avtg.id }}"
                for="avtg-{{ avtg.id }}"
                data-tooltip="{{ tooltip_text|raw }}"
                data-position="top"
                data-delay="50"
                data-html="true"
                class="change_avdesv change_avtg btn btn-medium bl tooltipped {{ class_more }}">
            <input data-augmentation="{{ avtg.augmentation }}"
                   type="hidden"
                   name="advantages[{{ avtg.id }}]"
                   value="{{ advantages[avtg.id] is defined and advantages[avtg.id] ? advantages[avtg.id] : '0' }}"
                   id="avtg-{{ avtg.id }}"
                   data-element-id="{{ avtg.id }}"
                   data-element-cost="{{ avtg.xp }}"
                   class="_hidden input_avtg" />
            <span>
                {%- if avtg.augmentation > 0 -%}
                    <span class="text-red">*</span>&nbsp;
                {%- endif -%}
                {{- avtg.name }} <small>(XP&nbsp;:&nbsp;{{ avtg.xp }})</small>
            </span>
        </label>

        {% if avtg.requiresIndication is not empty %}
            <div class="indication row" data-indication-for="{{ avtg.id }}">
                <div class="input-field col-s12">
                    {% if avtg.indicationType is same as(indication_type_single_choice) %}
                        <select name="advantages_indications[{{ avtg.id }}]" id="advantages_indications_{{ avtg.id }}">
                            <option value="">- {{ (avtg.requiresIndication~'.form')|trans }} -</option>
                            {% for bonus in avtg.bonusesFor %}
                                <option value="{{ bonus }}">{{ bonus|trans }}</option>
                            {% endfor %}
                        </select>
                    {% elseif avtg.indicationType is same as(indication_type_single_value) %}
                        <input type="text" name="advantages_indications[{{ avtg.id }}]" id="advantages_indications_{{ avtg.id }}">
                        <label for="advantages_indications_{{ avtg.id }}">
                            {{ (avtg.requiresIndication~'.form')|trans }}
                        </label>
                    {% endif %}
                </div>
            </div>
        {% endif %}
    </div>
{% endmacro %}

{% import _self as macros %}

{% block javascripts %}
{{ parent() }}
<script type="text/javascript" src="{{ asset('js/step_11_advantages.js') }}"></script>
{% endblock %}

{% block step_content %}

<div class="row">

    <p class="card-panel teal darken-4">
        {{ 'advantages.choose_multiple_times' | trans | raw }}
    </p>

    <p class="text-center">
        <span id="xp_chip" class="chip bordered text-m">{{ 'experience'|trans }} : <span id="xp">{{ experience }}</span></span>
    </p>

    <div id="list_advantages" class="col m6">
        <h4 class="text-center">{{ 'advantages.title' | trans}}</h4>
        <h6>{{ 'advantages.details'|trans }}</h6>
        {% for list in advantages_list|batch(2) %}
        <div class="row mb5">
            {% for avtg in list %}
                {{ macros.avantage_display(avtg, indication_type_single_choice, indication_type_single_value) }}
            {% endfor %}{# advantages #}
        </div>
    {% endfor %}
    </div>
    <div id="list_disadvantages" class="col m6">
        <h4 class="text-center">{{ 'disadvantages.title' | trans }}</h4>
        <h6>{{ 'disadvantages.details'|trans }}</h6>
        {% for list in disadvantages_list|batch(2) %}
            <div class="row mb5">
                {% for desv in list %}

                    {% set class_more = '' %}
                    {% if disadvantages[desv.id] is defined and disadvantages[desv.id] > 0 %}
                        {% set class_more = ' btn-state-'~disadvantages[desv.id] %}
                    {% endif %}

                    {% set tooltip_text %}
                        {{ desv.description | escape('html_attr') }}
                        <br>
                        ({{ 'disadvantages.xp_gain' | trans | escape('html_attr') }} : {{ desv.xp }})
                    {% endset %}

                    <div class="col m6">
                        <label
                              id="label-avdesv-{{ desv.id }}"
                              for="desv-{{ desv.id }}"
                              data-tooltip="{{ tooltip_text }}"
                              data-position="top"
                              data-delay="50"
                              data-html="true"
                              class="change_avdesv change_desv btn btn-medium bl tooltipped {{ class_more }}">
                            <input data-augmentation="{{ desv.augmentation }}"
                                   type="hidden"
                                   name="disadvantages[{{ desv.id }}]"
                                   value="{{ disadvantages[desv.id] is defined and disadvantages[desv.id] ? disadvantages[desv.id] : '0' }}"
                                   id="desv-{{ desv.id }}"
                                   data-element-id="{{ desv.id }}"
                                   data-element-cost="{{ desv.xp }}"
                                   class="_hidden input_desv" />
                            {%- if desv.augmentation > 0 -%}
                                <span class="text-red">*</span>&nbsp;
                            {%- endif -%}
                            {{- desv.name }} <small>(XP&nbsp;:&nbsp;{{ desv.xp }})</small>
                        </label>
                    </div>

                {% endfor %}
            </div><!-- /.row -->
        {% endfor %}
    </div>
</div>

{% endblock %}
